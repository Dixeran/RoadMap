webpackJsonp([1],{"/GeZ":function(t,e){},"1Ivt":function(t,e){},"9YdB":function(t,e){},ImsF:function(t,e){},JQS1:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("rVsN"),s=n.n(a),r=n("MVMM"),i=n("9rMa"),o=n("3cXf"),l=n.n(o),c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"User"}},[n("el-alert",{directives:[{name:"show",rawName:"v-show",value:""!=t.error,expression:"error != ''"}],attrs:{title:"登录/注册错误",type:"error",description:t.error,"show-icon":""}}),t._v(" "),n("el-form",{ref:"form",attrs:{model:t.form}},[n("el-form-item",{attrs:{label:"邮箱"}},[n("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"密码"}},[n("el-input",{model:{value:t.form.passwd,callback:function(e){t.$set(t.form,"passwd",e)},expression:"form.passwd"}})],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")]),t._v(" "),n("el-button",{on:{click:t.signin}},[t._v("注册")])],1)],1)],1)},staticRenderFns:[]},d={name:"Navbar",components:{User:n("Z0/y")({name:"User",data:function(){return{form:{name:"",passwd:""},error:""}},methods:{login:function(){var t=this;this.lcs.Login(this.form.name,this.form.passwd).then(function(){t.$emit("login")}).catch(function(){t.error="登录出错！"})},signin:function(){var t=this;this.lcs.Signin(this.form.name,this.form.passwd).then(function(){t.$emit("login")}).catch(function(){t.error="注册失败耶"})}}},c,!1,null,null,null).exports},data:function(){return{dialogVisible:!1,loading:!1}},methods:{storgeStateChange:function(t){t?this.lcs.isLogin()?this.login_success():(this.dialogVisible=!0,this.$store.state.storge.toCloud=!1):this.$store.state.storge.toCloud=!1},login_success:function(){this.$store.state.storge.toCloud=!0},save:function(){this.loading=!0,window.localStorage?(localStorage.setItem("roadmap",l()(this.$store.getters.exportData)),console.log(localStorage.getItem("roadmap")),this.loading=!1):(this.$message({message:"保存需要使用localstorge",type:"error"}),this.loading=!1)}}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Navbar"}},[t._m(0),t._v(" "),t.isMobile?t._e():n("ul",{attrs:{id:"navlist"}},[n("router-link",{attrs:{to:"/"}},[t._v("路径规划")]),t._v(" "),n("router-link",{attrs:{to:"/setting"}},[t._v("参数设置")])],1),t._v(" "),t.isMobile?t._e():n("input",{directives:[{name:"model",rawName:"v-model",value:t.$store.state.city,expression:"$store.state.city"}],class:""==t.$store.state.city?"unName":"",attrs:{id:"cityName",type:"text",placeholder:"输入城市名"},domProps:{value:t.$store.state.city},on:{input:function(e){e.target.composing||t.$set(t.$store.state,"city",e.target.value)}}}),t._v(" "),t.isMobile?t._e():n("el-popover",{attrs:{placement:"top-start",trigger:"hover"}},[n("el-switch",{attrs:{"active-text":"保存至云端"},on:{change:t.storgeStateChange},model:{value:t.$store.state.storge.toCloud,callback:function(e){t.$set(t.$store.state.storge,"toCloud",e)},expression:"$store.state.storge.toCloud"}}),t._v(" "),n("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{slot:"reference",icon:"el-icon-upload",circle:""},on:{click:t.save},slot:"reference"})],1),t._v(" "),n("el-dialog",{attrs:{title:"登录/注册",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("User",{on:{login:function(e){t.dialogVisible=!1}}})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"logo"}},[e("span",[this._v("RoadMap")])])}]};var f={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"Errorhandler"}},[this._v("\n  "+this._s(this.errorData)+"\n")])},staticRenderFns:[]};var p={name:"Initmodel",data:function(){return{init:!1,val:[],option:[],props:{label:"name",value:"name",children:"districtList"}}},created:function(){this.lcs.Init()},mounted:function(){var t=this;AMap.service("AMap.DistrictSearch",function(){new AMap.DistrictSearch({level:"country",subdistrict:2}).search("中国",function(e,n){t.formatArray(n.districtList[0].districtList),t.option=n.districtList[0].districtList})}),this.isMobile&&this.importLocal()},methods:{formatArray:function(t){var e=this;t.forEach(function(t){t.districtList&&0!=t.districtList.length&&"district"!=t.districtList[0].level?e.formatArray(t.districtList):t.districtList=null,t.label=t.value=t.name,t.children=t.districtList})},importLocal:function(){var t=JSON.parse(localStorage.getItem("roadmap"));this.$store.state.storge.localData=t,this.$store.state.city=t.city,this.$store.state.AMap_PlaceSearch.config.city=t.city,this.init=!0,this.$emit("init")}},watch:{val:function(){var t=this.val[this.val.length-1];this.$store.state.city=t;var e=this.$store.state.AMap_PlaceSearch.config;e.city=t;var n=new AMap.PlaceSearch(e);this.$store.commit("setPlaceSearch",{config:e,search:n}),this.init=!0,this.$emit("init")}}},v={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.init?t._e():n("div",{attrs:{id:"Initmodel"}},[n("div",{attrs:{id:"container"}},[n("div",{attrs:{id:"select"}},[n("h1",[t._v("去哪？(･ω´･ )")]),t._v(" "),n("div",{attrs:{id:"select-or"}},[n("el-cascader",{attrs:{options:t.option,size:"medium"},model:{value:t.val,callback:function(e){t.val=e},expression:"val"}})],1)]),t._v(" "),n("div",{attrs:{id:"import"}},[n("h1",[t._v("导入！")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.importLocal}},[t._v("本地导入")]),t._v(" "),n("el-button",{attrs:{plain:""}},[t._v("云端导入")])],1)])])},staticRenderFns:[]};var m={name:"App",components:{Navbar:n("Z0/y")(d,u,!1,function(t){n("l600")},"data-v-12e6b838",null).exports,Errorhandler:n("Z0/y")({name:"Errorhandler",props:["errorData"]},f,!1,function(t){n("zpZT")},"data-v-0ea0fdf0",null).exports,Initmodel:n("Z0/y")(p,v,!1,function(t){n("qCYc")},"data-v-c327109c",null).exports},methods:{errorConfirmed:function(t){this.error=""},HandleError:function(t){this.error=t}},data:function(){return{error:"",init:!1}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Initmodel",{on:{init:function(e){t.init=!0}}}),t._v(" "),n("Navbar"),t._v(" "),n("transition",{attrs:{name:"slide"}},[""!=t.error?n("Errorhandler",{attrs:{errorData:t.error},nativeOn:{click:function(e){return t.errorConfirmed(e)}}}):t._e()],1),t._v(" "),t.init?n("keep-alive",{attrs:{include:"Roadpage"},on:{error:t.HandleError}},[n("router-view")],1):t._e()],1)},staticRenderFns:[]};var _=n("Z0/y")(m,h,!1,function(t){n("pguA")},null,null).exports,g=n("zO6J"),y={name:"Checklist",mounted:function(){var t=this,e=new XMLHttpRequest;e.open("get","https://v1.hitokoto.cn/?c=d"),e.onreadystatechange=function(){if(4===e.readyState){var n=JSON.parse(e.responseText);"。"==n.hitokoto[n.hitokoto.length-1]&&(n.hitokoto=n.hitokoto.substring(0,n.hitokoto.length-1)),t.hitokoto=n}},e.send()},data:function(){return{hitokoto:{}}},computed:{mapState:function(){return this.$store.state}}},w={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Checklist"}},[n("el-row",{attrs:{justify:"end",type:"flex"}},[n("el-col",{attrs:{span:20}},[n("h1",{staticClass:"text",attrs:{id:"hTitle"}},[t._v(t._s(t.mapState.city)+" "+t._s(t.mapState.POIs.length)+" 日游")])])],1),t._v(" "),n("el-row",{attrs:{justify:"end",type:"flex"}},[n("el-col",{attrs:{span:16}},[n("h2",{staticClass:"text",attrs:{id:"mTitle"}},[t._v(t._s(t.hitokoto.hitokoto))]),t._v(" "),n("h2",{staticClass:"text",attrs:{id:"mTitle"}},[t._v("—— 《"+t._s(t.hitokoto.from)+"》")])])],1),t._v(" "),t._l(t.$store.state.POIs,function(e,a){return n("el-row",{key:a,staticClass:"block",attrs:{type:"flex",justify:"center"}},[n("el-col",{attrs:{span:4}},[n("h3",{staticClass:"text dTitle"},[t._v("Day "+t._s(a+1))])]),t._v(" "),n("el-col",{attrs:{span:20}},[n("el-table",{attrs:{data:e}},[n("el-table-column",{attrs:{prop:"detail.name",label:"名称"}}),t._v(" "),n("el-table-column",{attrs:{prop:"detail.address",label:"地址"}}),t._v(" "),n("el-table-column",{attrs:{prop:"detail.name",label:"Tag"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tag",[t._v(t._s(e.row.detail.type.split(";")[0]))]),t._v(" "),e.row.detail.groupby?n("el-tag",[t._v("团购")]):t._e()]}}])})],1)],1)],1)})],2)},staticRenderFns:[]};var $=n("Z0/y")(y,w,!1,function(t){n("hLJu")},"data-v-0641327c",null).exports,I=n("HOBB"),x=n.n(I),P={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Drivedetail"}},[n("p",{staticClass:"nums"},[t._v("驾驶距离："),n("code",[t._v(t._s(t.Rtem.distance))]),t._v(" 米")]),t._v(" "),n("p",{staticClass:"nums"},[t._v("预计耗时："),n("code",[t._v(t._s(t.Rtem.time/60))]),t._v(" 分钟")]),t._v(" "),0!==t.Rtem.tolls?n("p",{staticClass:"nums"},[t._v("路费："),n("code",[t._v(t._s(t.Rtem.tolls))]),t._v(" 元")]):t._e(),t._v(" "),1==t.Rtem.restriction?n("p",{staticClass:"nums"},[n("i"),n("code",[t._v("存在限行警告")])]):t._e()])},staticRenderFns:[]};var D=n("Z0/y")({name:"Drivedetail",props:["item"],computed:{Rtem:function(){return this.item.plan.routes[0]}}},P,!1,function(t){n("ImsF")},"data-v-31616e44",null).exports,k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Walkdetail"}},[n("p",{staticClass:"nums"},[t._v("步行距离："),n("code",[t._v(t._s(t.Rtem.distance))]),t._v(" 米")]),t._v(" "),n("p",{staticClass:"nums"},[t._v("预计耗时："),n("code",[t._v(t._s(Math.floor(t.Rtem.time/60)))]),t._v(" 分钟")])])},staticRenderFns:[]};var O=n("Z0/y")({name:"Walkdetail",props:["item"],computed:{Rtem:function(){return this.item.plan.routes[0]}}},k,!1,function(t){n("e2F2")},"data-v-5fd0f19a",null).exports,T={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Busdetail"}},[n("p",{staticClass:"nums"},[t._v("路程花费："),n("code",[t._v(t._s(t.Rtem.cost))]),t._v(" 元")]),t._v(" "),n("p",{staticClass:"nums"},[t._v("预期时间："),n("code",[t._v(t._s(Math.floor(t.Rtem.time)))]),t._v(" 分钟")]),t._v(" "),n("p",{staticClass:"nums"},[t._v("全程距离："),n("code",[t._v(t._s(t.Rtem.distance))]),t._v(" 米")]),t._v(" "),n("p",{staticClass:"nums"},[t._v("步行距离："),n("code",[t._v(t._s(t.Rtem.walking_distance))]),t._v(" 米")])])},staticRenderFns:[]};var b=n("Z0/y")({name:"Busdetail",props:["item"],computed:{Rtem:function(){return this.item.plan.plans?this.item.plan.plans[0]:this.item.plan.routes[0]}}},T,!1,function(t){n("hZhd")},"data-v-7011cac4",null).exports,C={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Ridedetail"}},[n("p",{staticClass:"nums"},[t._v("骑行距离："),n("code",[t._v(t._s(t.Rtem.distance))]),t._v(" 米")]),t._v(" "),n("p",{staticClass:"nums"},[t._v("预计耗时："),n("code",[t._v(t._s(Math.floor(t.Rtem.time/60)))]),t._v(" 分钟")])])},staticRenderFns:[]};var M=n("Z0/y")({name:"Ridedetail",props:["item"],computed:{Rtem:function(){return this.item.plan.routes[0]}}},C,!1,function(t){n("JQS1")},"data-v-7db58c69",null).exports,A=n("V2Z7"),F=n.n(A),R={name:"Collapse",components:{Drivedetail:D,Walkdetail:O,Busdetail:b,Ridedetail:M},props:["transferItem"],data:function(){return{isActive:!1,contentHeight:0,_mounted:!1}},mounted:function(){this.$children[0]&&(this.contentHeight=this.$el.clientHeight-this.$children[0].$el.clientHeight)},methods:{transActive:function(){var t=0;t=this.isActive?this.$el.clientHeight-this.$children[0].$el.clientHeight:this.$el.clientHeight+this.$children[0].$el.clientHeight,console.log(this.$el.clientHeight),console.log(t);var e=new F.a.Tween(this).to({contentHeight:t},200);e.easing(F.a.Easing.Cubic.InOut),e.start(),function t(){requestAnimationFrame(t);F.a.update()}(),this.isActive=!this.isActive}},computed:{transferComp:function(){return"driving"===this.transferItem.type?D:"walk"===this.transferItem.type?O:"bus"===this.transferItem.type?b:M}},watch:{contentHeight:function(){this.$el.style.height=this.contentHeight+"px"}}},S={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Collapse"}},[n("span",{staticClass:"select"},[t._t("selector")],2),t._v(" "),n("span",{staticClass:"trigger",on:{click:t.transActive}},[n("i",{staticClass:"iconfont icon-more"})]),t._v(" "),n("div",{attrs:{id:"content"}},[t.transferItem?n(t.transferComp,{tag:"component",attrs:{item:t.transferItem}}):t._e()],1)])},staticRenderFns:[]};var E={name:"Cardcollapse",props:["detail"],data:function(){return{isActive:!1,contentHeight:0}},methods:{transActive:function(){var t=this.$el.querySelector("#content"),e=0;e=this.isActive?this.$el.clientHeight-t.clientHeight:this.$el.clientHeight+t.clientHeight;var n=new F.a.Tween(this).to({contentHeight:e},200);n.easing(F.a.Easing.Cubic.InOut),n.start(),function t(){requestAnimationFrame(t);F.a.update()}(),this.isActive=!this.isActive}},mounted:function(){this.contentHeight=this.$el.clientHeight-this.$el.querySelector("#content").clientHeight},computed:{transferComp:function(){return"driving"===this.transferItem.type?Drivedetail:"walk"===this.transferItem.type?Walkdetail:"bus"===this.transferItem.type?Busdetail:Ridedetail}},watch:{contentHeight:function(){this.$el.style.height=this.contentHeight+"px"}}},L={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Cardcollapse"}},[n("div",{attrs:{id:"trigger"},on:{click:t.transActive}},[t._t("header")],2),t._v(" "),n("div",{attrs:{id:"content"}},[n("h1",[t._v(t._s(t.detail.type))]),t._v(" "),"DINING"==t.detail.deep_type?n("div",{staticClass:"dts"},[n("p",[t._v("开业时间："),n("code",[t._v(t._s(t.detail.dining.opentime))])]),t._v(" "),n("p",[t._v("打分："),n("code",[t._v(t._s(t.detail.dining.cp_rating))])]),t._v(" "),n("p",[t._v("人均花费："),n("code",[t._v(t._s(t.detail.dining.cost))]),t._v(" 元")])]):t._e(),t._v(" "),"SCENIC"==t.detail.deep_type?n("div",{staticClass:"dts"},[n("p",[t._v("开放时间："),n("code",[t._v(t._s(t.detail.scenic.opentime))])]),t._v(" "),t.detail.scenic.rating?n("p",[t._v("评分："),n("code",[t._v(t._s(t.detail.scenic.rating))])]):t._e(),t._v(" "),0!=t.detail.scenic.price?n("p",[t._v("门票价格："),n("code",[t._v(t._s(t.detail.scenic.price))]),t._v(" 元")]):t._e()]):t._e(),t._v(" "),"HOTEL"==t.detail.deep_type?n("div",{staticClass:"dts"},[n("p",[t._v("评分："),n("code",[t._v(t._s(t.detail.hotel.rating))])]),t._v(" "),n("p",[t._v("星级："),n("code",[t._v(t._s(t.detail.hotel.star))])]),t._v(" "),n("p",[t._v("最低价格："),n("code",[t._v(t._s(t.detail.hotel.lowest_price))]),t._v(" 元")])]):t._e()])])},staticRenderFns:[]};var H={name:"Detailpath",components:{Collapse:n("Z0/y")(R,S,!1,function(t){n("qDiX")},"data-v-bb826a9e",null).exports,Cardcollapse:n("Z0/y")(E,L,!1,function(t){n("1Ivt")},"data-v-78f5b1a7",null).exports},data:function(){return{transPlan:[{data:"driving",name:"驾车"},{data:"bus",name:"公交"},{data:"ride",name:"骑行"},{data:"walk",name:"步行"}]}},methods:{},updated:function(){var t=this,e=document.getElementById("nodex");x.a.create(e,{animation:120,handle:".cd-main",draggable:".nodeCard",supportPointer:!1,onStart:function(e){t.$emit("drag")},onEnd:function(e){if(t.$emit("drag"),e.oldIndex!==e.newIndex){if(e.oldIndex<e.newIndex){var n=e.from.childNodes[e.oldIndex];e.from.insertBefore(e.item,n)}else{var a=e.from.childNodes[e.oldIndex+1]||null;a?e.from.insertBefore(e.item,a):e.from.appendChild(e.item)}t.$emit("sort",e.oldIndex,e.newIndex)}},setData:function(t,e){t.setData("ItemIndex",e.getAttribute("index"))}})}},N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Detailpath"}},[n("div",{attrs:{id:"daySelector"}},[n("div",{attrs:{id:"selector"}},[n("a",{attrs:{href:"#"},on:{click:function(e){t.$store.commit("switchDay",t.$store.state.nowDay-1)}}},[n("i",{staticClass:"iconfont icon-left"})]),t._v(" "),n("span",[t._v("第"),n("span",[t._v(t._s(t.$store.state.nowDay+1))]),t._v("天")]),t._v(" "),n("a",{attrs:{href:"#"},on:{click:function(e){t.$store.commit("switchDay",t.$store.state.nowDay+1)}}},[n("i",{staticClass:"iconfont icon-right"})]),t._v(" "),t.isMobile?t._e():n("a",{attrs:{href:"#"},on:{click:function(e){t.$store.commit("addNewDay")}}},[n("i",{staticClass:"iconfont icon-plus"})]),t._v(" "),t.isMobile?t._e():n("a",{staticClass:"alert",attrs:{href:"#"},on:{click:function(e){t.$store.commit("deleteDay",t.$store.state.nowDay)}}},[n("i",{staticClass:"iconfont icon-minus"})])]),t._v(" "),n("div",{attrs:{id:"total"},on:{click:function(e){t.$emit("updateTransferPlan",5,5)}}},[t._v("\n      共"+t._s(t.$store.state.totalDays)+"天\n    ")])]),t._v(" "),n("div",{attrs:{id:"paths"}},[n("ul",{attrs:{id:"nodex"}},[t._l(t.$store.state.POIs[t.$store.state.nowDay],function(e,a){return[n("div",{key:e.name,staticClass:"nodeCard",attrs:{index:a}},[e.transfer?n("Collapse",{attrs:{transferItem:e.transfer}},[n("div",{staticClass:"cd-select-group",attrs:{slot:"selector"},slot:"selector"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.transfer.type,expression:"item.transfer.type"}],staticClass:"cd-select",attrs:{name:"cd-method"},on:{change:[function(n){var a=Array.prototype.filter.call(n.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e.transfer,"type",n.target.multiple?a:a[0])},function(n){t.$emit("updateTransferPlan",a,e.transfer.type)}]}},t._l(t.transPlan,function(e){return n("option",{key:e.data,domProps:{value:e.data}},[t._v("\n                  "+t._s(e.name)+"\n                ")])})),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.transfer.index,expression:"item.transfer.index"}],staticClass:"cd-select",attrs:{name:"cd-plan"},on:{change:[function(n){var a=Array.prototype.filter.call(n.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e.transfer,"index",n.target.multiple?a:a[0])},function(n){t.$emit("updateTransferIndex",a,e.transfer.index)}]}},t._l((e.transfer.plan.routes||e.transfer.plan.plans).length,function(e){return n("option",{key:e,domProps:{value:e-1}},[t._v("\n                  方案"+t._s(e)+"\n                ")])}))])]):t._e(),t._v(" "),n("div",{staticClass:"cd-main"},[n("Cardcollapse",{attrs:{detail:e.detail}},[n("div",{attrs:{slot:"header",type:"simple"},slot:"header"},[n("p",[t._v(t._s(e.detail.name))]),t._v(" "),n("p",{staticClass:"sm"},[t._v(t._s(e.detail.address))])])])],1),t._v(" "),n("div",{staticClass:"cd-footer"},[n("button",{attrs:{href:"#"},on:{click:function(e){t.$emit("setCenter",a)}}},[n("i",{staticClass:"iconfont icon-androidlocate"})]),t._v(" "),t._m(0,!0),t._v(" "),n("button",{attrs:{href:"#"},on:{click:function(e){t.$emit("moveTo",a,null)}}},[n("i",{staticClass:"iconfont icon-delete color-alert"})])])],1)]})],2)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("button",{attrs:{href:"#"}},[e("i",{staticClass:"iconfont icon-move"})])}]};var W=n("Z0/y")(H,N,!1,function(t){n("9YdB")},"data-v-8da350b4",null).exports,Z=n("lC5x"),U=n.n(Z),B=n("J0Oq"),j=n.n(B),J={name:"Searchbar",data:function(){return{keyWord:"",suggests:[],page:1,lastSearch:null}},watch:{keyWord:function(){if(!this.lastSearch||this.lastSearch.getTime()-(new Date).getTime()<=-300){this.lastSearch=new Date;var t=this;this.$store.state.AMap_PlaceSearch.search.search(this.keyWord,function(e,n){"complete"==e&&n.poiList.count>0?t.suggests=n.poiList.pois:console.log(n)})}}},methods:{searchChecked:function(t){var e={id:t.id,name:t.name,lnglat:t.location,type:t.type};this.$emit("searchChecked",e),this.keyWord=""}}},q={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Searchbar"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.keyWord,expression:"keyWord"}],attrs:{type:"search",name:"searchPOI",id:"searchTile",placeholder:"搜索景点.."},domProps:{value:t.keyWord},on:{input:function(e){e.target.composing||(t.keyWord=e.target.value)}}}),t._v(" "),n("transition",{attrs:{name:"list"}},[""!=t.keyWord?n("div",{attrs:{id:"searchResult"}},[n("ul",[t._l(t.suggests,function(e){return[n("div",{key:e.id,staticClass:"suggest",on:{click:function(n){t.searchChecked(e)}}},[n("span",{attrs:{type:"name"}},[t._v(t._s(e.name))]),t._v(" "),n("span",{attrs:{type:"location"}},[t._v(t._s(e.address))])])]})],2)]):t._e()])],1)},staticRenderFns:[]};var V=n("Z0/y")(J,q,!1,function(t){n("kK4M")},"data-v-5c597b58",null).exports,z=(n("i8gr"),{name:"Mapcontainer",components:{Searchbar:V},data:function(){return{count:0,map:{}}},created:function(){var t=this;this.$parent.$on("updateTransferPlan",function(e,n){var a=t.$store.state.POIs[t.$store.state.nowDay][e-1].detail.location,s=t.$store.state.POIs[t.$store.state.nowDay][e].detail.location;t.createTransferObj(a,s,n).then(function(n){t.$store.commit({type:"updateTransferPlan",newTransfer:n,index:e})})}),this.$parent.$on("updateTransferIndex",function(e,n){t.updateTransferIndex(e,n)}),this.$parent.$on("setCenter",function(e){var n=t.$store.state.POIs[t.$store.state.nowDay][e].marker.getPosition();t.map.panTo(n)}),this.$parent.$on("moveTo",function(e,n){var a=t.$store.state.POIs[t.$store.state.nowDay][e];a.marker.hide();for(var s=0;a.transfer&&s<a.transfer.routes.length;s++)a.transfer.routes[s].hide();if(t.$store.commit("wipe",e),null===n){a=null;var r=t.$store.state.POIs[t.$store.state.nowDay][e-1]||null,i=t.$store.state.POIs[t.$store.state.nowDay][e]||null;r&&i?t.createTransferObj(r.detail.location,i.detail.location,i.transfer.type).then(function(n){t.$store.commit({type:"updateTransferPlan",newTransfer:n,index:e})}):i&&t.$store.commit({type:"updateTransferPlan",newTransfer:null,index:e})}else{var o=t.$store.state.POIs[t.$store.state.nowDay][e-1]||null,l=t.$store.state.POIs[t.$store.state.nowDay][e]||null;o&&l?t.createTransferObj(o.detail.location,l.detail.location,l.transfer.type).then(function(n){t.$store.commit({type:"updateTransferPlan",newTransfer:n,index:e})}):l&&t.$store.commit({type:"updateTransferPlan",newTransfer:null,index:e});var c=t.$store.state.POIs[n];if(0!=c.length){var d=c[c.length-1].detail.location,u=a.detail.location;t.createTransferObj(d,u,"driving").then(function(e){a.transfer=e;for(var s=0;s<e.routes.length;s++)e.routes[s].hide();t.$store.dispatch({type:"addPOIFromMap",data:a,dayTo:n})})}else a.transfer=null,t.$store.dispatch({type:"addPOIFromMap",data:a,dayTo:n})}}),this.$parent.$on("sort",function(e,n){var a=t.$store.state.POIs[t.$store.state.nowDay][e],s=t.$store.state.POIs[t.$store.state.nowDay][e-1]||null,r=t.$store.state.POIs[t.$store.state.nowDay][e+1]||null;if(s&&r){var i=s.detail.location,o=r.detail.location;t.createTransferObj(i,o,"driving").then(function(n){t.$store.commit("updateTransferPlan",{newTransfer:n,index:e+1})})}else r&&t.$store.commit("updateTransferPlan",{newTransfer:null,index:e+1});t.$store.commit("sortItem",{oldIndex:e,newIndex:n});var l=t.$store.state.POIs[t.$store.state.nowDay][n-1]||null;if(l){var c=l.detail.location,d=a.detail.location;t.createTransferObj(c,d,"driving").then(function(e){t.$store.commit("updateTransferPlan",{newTransfer:e,index:n})})}else t.$store.commit("updateTransferPlan",{newTransfer:null,index:n});var u=t.$store.state.POIs[t.$store.state.nowDay][n+1]||null;if(u){var f=a.detail.location,p=u.detail.location;t.createTransferObj(f,p,"driving").then(function(e){t.$store.commit("updateTransferPlan",{newTransfer:e,index:n+1})})}})},mounted:function(){var t=new AMap.Map("map",{resizeEnable:!0,zoom:11,center:[116.397428,39.90923],animateEnable:!0,mapStyle:"amap://styles/fe7d1f157e05c97d6930995928e4f39d"});t.setCity(this.$store.state.city),this.map=t;var e=this.$store.state.AMap_PlaceSearch.config,n=new AMap.PlaceSearch(e);this.$store.commit("setPlaceSearch",{config:e,search:n});var a=this;t.on("hotspotclick",function(t){a.createInfoWindow(t)});if(this.$store.state.storge.localData){var r=function(t,e,n){return new s.a(function(s,r){var i={};i.id=t.id,n.getDetails(t.id,function(n,r){i.detail=r.poiList.pois[0];var o=new AMap.Marker({map:a.map,position:i.detail.location,animation:"AMAP_ANIMATION_DROP",title:i.detail.name});if(o.show(),i.marker=o,t.transfer&&e){var l=e.detail.location;a.createTransferObj(l,i.detail.location,t.transfer.type).then(function(t){i.transfer=t,s(i)})}else i.transfer=null,s(i)})})};this.$emit("setLoading",!0);var i=this.$store.state.storge.localData,o=new AMap.PlaceSearch({city:i.city});j()(U.a.mark(function t(){var e,n,s,l;return U.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:if(!(e<i.POIs.length)){t.next=19;break}e!=i.POIs.length-1&&a.$store.commit("addNewDay"),n=0;case 4:if(!(n<i.POIs[e].length)){t.next=15;break}return t.next=7,r(i.POIs[e][n],0==n?null:a.$store.state.POIs[e][n-1],o);case 7:return s=t.sent,console.log(s),t.next=11,a.$store.dispatch({type:"addPOIFromMap",data:s,dayTo:e});case 11:i.POIs[e][n].transfer&&0!=i.POIs[e][n].transfer.index&&(l=i.POIs[e][n].transfer.index,a.updateTransferIndex(n,l));case 12:n++,t.next=4;break;case 15:e!=i.POIs.length-1&&a.$store.commit("switchDay",e+1);case 16:e++,t.next=1;break;case 19:a.$emit("setLoading",!1);case 20:case"end":return t.stop()}},t,this)}))()}},methods:{createInfoWindow:function(t){var e=document.createElement("div"),n='<div id="infoWindow">        <span class="infoName">'+t.name+'</span>        <span id="infoAction">          <i class="iconfont icon-plus"></i>        </span>      </div>      <div id="infoWindowArrow">        <div></div>      </div>';e.innerHTML+=n;var a=this;e.querySelector("#infoAction").onclick=function(e){a.addPOIToData(t)},new AMap.InfoWindow({isCustom:!0,content:e,offset:new AMap.Pixel(0,-10),closeWhenClickMap:!0,autoMove:!0}).open(this.map,t.lnglat)},drawResultOnMap:function(t,e,n){var a=[];if("driving"===n){for(var s=[],r=0;r<t.routes[e].steps.length;r++)for(var i=0;i<t.routes[e].steps[r].path.length;i++)s.push(t.routes[e].steps[r].path[i]);var o=new AMap.Polyline({map:this.map,isOutline:!0,outlineColor:"#FFFFFF",strokeWeight:5,strokeColor:"#13afc8",showDir:!0,lineJoin:"round",path:s});return a.push(o),a}if("bus"===n){for(var l=t.plans[e],c=0;c<l.segments.length;c++){var d=l.segments[c].transit_mode,u=new AMap.Polyline({map:this.map,isOutline:!0,outlineColor:"#FFFFFF",strokeWeight:5,strokeColor:"BUS"==d?"#2775b6":"SUBWAY"==d?"#51c4d3":"#fed71a",showDir:!0,lineJoin:"round",path:l.segments[c].transit.path});a.push(u)}return a}if("ride"===n){for(var f=t.routes[e],p=[],v=0;v<f.rides.length;v++)for(var m=0;m<f.rides[v].path.length;m++)p.push(f.rides[v].path[m]);var h=new AMap.Polyline({map:this.map,isOutline:!0,outlineColor:"#FFFFFF",strokeWeight:5,strokeColor:"#21a265",showDir:!0,lineJoin:"round",path:p});return a.push(h),a}if("walk"===n){for(var _=t.routes[e],g=[],y=0;y<_.steps.length;y++)for(var w=0;w<_.steps[y].path.length;w++)g.push(_.steps[y].path[w]);var $=new AMap.Polyline({map:this.map,isOutline:!0,outlineColor:"#FFFFFF",strokeWeight:5,strokeColor:"#fed71a",showDir:!0,lineJoin:"round",path:g});return a.push($),a}},createTransferObj:function(t,e,n){var a=this;return new s.a(function(s,r){var i={type:"",index:0,kit:{},plan:{},routes:{}};if("driving"===n){i.type="driving";var o=new AMap.Driving(a.$store.state.AMap_Driving);i.kit=o,o.search(t,e,function(t,e){"complete"==t?(i.plan=e,i.routes=a.drawResultOnMap(e,0,"driving"),s(i)):(console.log(e),r())})}else if("bus"===n){i.type="bus",a.$store.state.AMap_Bus.city=a.$store.state.city;var l=new AMap.Transfer(a.$store.state.AMap_Bus);i.kit=l,l.search(t,e,function(t,e){"complete"==t?(i.plan=e,i.routes=a.drawResultOnMap(e,0,"bus"),s(i)):r(e)})}else if("ride"===n){i.type="ride";var c=new AMap.Riding(a.$store.state.AMap_Ride);i.kit=c,c.search(t,e,function(t,e){"complete"==t?(i.plan=e,i.routes=a.drawResultOnMap(e,0,"ride"),s(i)):r(e)})}else if("walk"===n){i.type="walk";var d=new AMap.Walking(a.$store.state.AMap_Walk);i.kit=d,d.search(t,e,function(t,e){"complete"==t?(i.plan=e,i.routes=a.drawResultOnMap(e,0,"walk"),s(i)):r(e)})}})},addPOIToData:function(t){for(var e=this.$store.state.POIs,n=0;n<e.length;n++)for(var a=0;a<e[n].length;a++)if(e[n][a].id==t.id)return;var s=this,r=new AMap.Marker({map:s.map,position:t.lnglat,animation:"AMAP_ANIMATION_DROP",title:t.name});r.show();var i=this.$store.state.POIs[this.$store.state.nowDay],o={id:t.id,marker:r,transfer:null};i.length>0?this.createTransferObj(i[i.length-1].detail.location,t.lnglat,"driving").then(function(t){console.log(t),o.transfer=t,s.$store.dispatch({type:"addPOIFromMap",data:o}),s.$emit("setLoading",!1)}).catch(function(t){console.log(t)}):s.$store.dispatch({type:"addPOIFromMap",data:o})},updateTransferIndex:function(t,e){var n=this.$store.state.POIs[this.$store.state.nowDay][t].transfer,a=this.drawResultOnMap(n.plan,e,n.type);this.$store.commit({type:"updateTransferIndex",newRoutes:a,index:t,transferIndex:e})}}}),K={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"Mapcontainer"}},[e("div",{attrs:{id:"map"}}),this._v(" "),this.isMobile?this._e():e("Searchbar",{on:{searchChecked:this.createInfoWindow}})],1)},staticRenderFns:[]};var X={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Daytransmit"}},[n("div",{staticClass:"header"},[t._v("拖动至此处分发到其他日期")]),t._v(" "),n("ul",t._l(t.$store.state.totalDays,function(e){return e-1!=t.$store.state.nowDay?n("div",{key:e,staticClass:"item",attrs:{dayIndex:e-1},on:{dragover:function(t){t.preventDefault()},drop:function(e){e.preventDefault(),t.moveTo(e)}}},[1==e||e-2==t.$store.state.nowDay&&e-1==1?t._e():n("div",{staticClass:"item-line"}),t._v(" "),n("i",{staticClass:"item-icon iconfont icon-right"}),t._v("\n      第"+t._s(e)+"天\n    ")]):t._e()}))])},staticRenderFns:[]};var Y={name:"Drawer",props:["width","enable"],data:function(){return{leftMargin:0}},watch:{enable:function(t){if(t){new F.a.Tween(this).to({leftMargin:-this.width},150).start(),function t(){requestAnimationFrame(t),F.a.update()}()}else{new F.a.Tween(this).to({leftMargin:0},150).start(),function t(){requestAnimationFrame(t),F.a.update()}()}}}},G={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:{width:t.width+"px",marginLeft:t.leftMargin+"px"},attrs:{id:"Drawer"}},[n("div",{attrs:{id:"content"}},[t._t("default")],2),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.enable?n("div",{attrs:{id:"mask"},on:{click:function(e){t.$emit("close")}}}):t._e()])],1)},staticRenderFns:[]};var Q={name:"Roadpage",components:{Detailpath:W,Mapcontainer:n("Z0/y")(z,K,!1,function(t){n("xkSc")},null,null).exports,Daytransmit:n("Z0/y")({name:"Daytransmit",data:function(){return{}},methods:{moveTo:function(t){var e=t.dataTransfer.getData("ItemIndex");this.$emit("moveTo",e,t.target.getAttribute("dayIndex"))}}},X,!1,function(t){n("UFyb")},"data-v-002b6210",null).exports,Drawer:n("Z0/y")(Y,G,!1,function(t){n("UKb1")},"data-v-9a49aace",null).exports},data:function(){return{onDrag:!1,loading:!1,drawerOpen:!1}},methods:{updateTransferPlan:function(t,e){this.$emit("updateTransferPlan",t,e)},updateTransferIndex:function(t,e){this.$emit("updateTransferIndex",t,e)},setCenter:function(t){this.$emit("setCenter",t)},moveTo:function(t,e){this.$emit("moveTo",t,e)},sort:function(t,e){this.$emit("sort",t,e)},setLoading:function(t){this.loading=t}}},tt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"Roadpage"}},[n("Mapcontainer",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],on:{setLoading:t.setLoading}}),t._v(" "),t.onDrag?n("Daytransmit",{on:{moveTo:t.moveTo}}):t._e(),t._v(" "),t.isMobile?t._e():n("Detailpath",{on:{updateTransferPlan:t.updateTransferPlan,updateTransferIndex:t.updateTransferIndex,setCenter:t.setCenter,moveTo:t.moveTo,drag:function(e){t.onDrag=!t.onDrag},sort:t.sort}}),t._v(" "),t.isMobile?n("Drawer",{attrs:{width:300,enable:t.drawerOpen},on:{close:function(e){t.drawerOpen=!1}}},[n("Detailpath",{on:{updateTransferPlan:t.updateTransferPlan,updateTransferIndex:t.updateTransferIndex,setCenter:t.setCenter,moveTo:t.moveTo,drag:function(e){t.onDrag=!t.onDrag},sort:t.sort}})],1):t._e(),t._v(" "),t.isMobile?n("div",{attrs:{id:"footer"},on:{click:function(e){t.drawerOpen=!0}}},[n("i",{staticClass:"iconfont icon-menu"})]):t._e()],1)},staticRenderFns:[]};var et=n("Z0/y")(Q,tt,!1,function(t){n("/GeZ")},"data-v-79496a2a",null).exports;r.default.use(g.a);var nt=new g.a({routes:[{path:"/",name:"Roadpage",component:et,meta:{keepAlive:!0}},{path:"/setting",name:"Setting",component:$}],linkExactActiveClass:"active"}),at=n("UM93"),st=n.n(at),rt=(n("bTWF"),n("JnRc")),it=n.n(rt),ot=(n("AJcs"),{install:function(t,e){t.mixin({data:function(){return{lcs:{Init:function(){it.a.init({appId:"Bc3luL7In6UFyXHh5Vybnavi-gzGzoHsz",appKey:"ff359xQsjpOvWjxit9PsffnR"})},Login:function(t,e){return new s.a(function(n,a){it.a.User.logIn(t,e).then(function(t){console.log("login success:"+t),n()},function(t){console.warn("login error:"+t),a()})})},Logout:function(){it.a.User.logOut()},Signin:function(t,e){return new s.a(function(n,a){var s=new it.a.User;s.setUsername(t),s.setPassword(e),s.setEmail(t),s.signUp().then(function(t){console.log("signin success:"+t),n()},function(t){console.warn("signin error:"+t),a()})})},isLogin:function(){var t=it.a.User.current();return!!t&&(console.log(t),!0)},saveToCloud:function(t){return new s.a(function(t,e){if(it.a.User.current()){it.a.User.current();var n=new it.a.Query("roadmap");n.equalTo("owner"),n.find().then(function(t){console.log(t)})}else e()})}}}},methods:{test:function(){console.log("mixin")}}})}});r.default.use(i.a),r.default.use(st.a),location.search.indexOf("mobile")<0?r.default.mixin({data:function(){return{isMobile:!1}}}):r.default.mixin({data:function(){return{isMobile:!0}}}),r.default.use(ot),r.default.config.productionTip=!1;var lt=new i.a.Store({state:{city:"",totalDays:1,nowDay:0,POIs:[[]],AMap_PlaceSearch:{config:{city:"全国",extensions:"all"},search:{}},AMap_Driving:{policy:AMap.DrivingPolicy.LEAST_TIME,hideMarkers:!0,autoFitView:!1,showTraffic:!1},AMap_Bus:{city:"",hideMarkers:!0,autoFitView:!1},AMap_Ride:{hideMarkers:!0,autoFitView:!1},AMap_Walk:{hideMarkers:!0,autoFitView:!1},storge:{toCloud:!1,localData:""}},mutations:{setPlaceSearch:function(t,e){console.log(e),t.AMap_PlaceSearch.config=e.config,t.AMap_PlaceSearch.search=e.search},addNewDay:function(t){t.totalDays++,t.POIs.push([])},switchDay:function(t,e){if(e<t.totalDays&&e>=0){for(var n=t.POIs[t.nowDay],a=0;a<n.length;a++)if(n[a].marker.hide(),n[a].transfer)for(var s=0;s<n[a].transfer.routes.length;s++)n[a].transfer.routes[s].hide();for(var r=t.POIs[e],i=0;i<r.length;i++)if(r[i].marker.show(),r[i].transfer)for(var o=0;o<r[i].transfer.routes.length;o++)r[i].transfer.routes[o].show();t.nowDay=e}},deleteDay:function(t,e){if(e<t.totalDays&&e>=0){for(var n=0;n<t.POIs[e].length;n++)t.POIs[e][n].marker.hide(),t.POIs[e][n].transfer&&t.POIs[e][n].transfer.routes.hide();if(t.POIs.splice(e,1),t.totalDays--,t.nowDay==e){t.nowDay>0&&t.nowDay--;for(var a=0;a<t.POIs[t.nowDay].length;a++)t.POIs[t.nowDay][a].marker.show(),t.POIs[t.nowDay][a].transfer&&t.POIs[t.nowDay][a].transfer.routes.show()}}},addPOIFromMap:function(t,e){e.dayTo?t.POIs[e.dayTo].push(e.data):t.POIs[t.nowDay].push(e.data)},updateTransferPlan:function(t,e){if(t.POIs[t.nowDay][e.index].transfer)for(var n=t.POIs[t.nowDay][e.index].transfer.routes,a=0;a<n.length;a++)n[a].hide();t.POIs[t.nowDay][e.index].transfer=e.newTransfer},updateTransferIndex:function(t,e){if(t.POIs[t.nowDay][e.index].transfer)for(var n=t.POIs[t.nowDay][e.index].transfer.routes,a=0;a<n.length;a++)n[a].hide();t.POIs[t.nowDay][e.index];t.POIs[t.nowDay][e.index].transfer.routes=e.newRoutes,t.POIs[t.nowDay][e.index].transfer.index=e.transferIndex},wipe:function(t,e){t.POIs[t.nowDay].splice(e,1)},sortItem:function(t,e){var n=t.POIs[t.nowDay];n.splice(e.newIndex,0,n.splice(e.oldIndex,1)[0])},setStorgeType:function(t,e){t.storge.toCloud=e}},actions:{addPOIFromMap:function(t,e){return new s.a(function(n,a){e.data.detail?(console.log("moveIN"),console.log(e.dayTo),t.commit("addPOIFromMap",e),n()):t.state.AMap_PlaceSearch.search.getDetails(e.data.id,function(a,s){"complete"==a?(e.data.detail=s.poiList.pois[0],t.commit("addPOIFromMap",e)):(console.log(s),t.commit("addPOIFromMap",e)),n()})})}},getters:{exportData:function(t){var e={};e.city=t.city,e.totalDays=t.totalDays;for(var n=[],a=0;a<t.totalDays;a++){n.push([]);for(var s=0;s<t.POIs[a].length;s++){var r=t.POIs[a][s];n[a].push({id:r.detail.id,transfer:r.transfer?{type:r.transfer.type,index:r.transfer.index}:null})}}return e.POIs=n,e}}});new r.default({el:"#app",router:nt,store:lt,components:{App:_},template:"<App/>"})},UFyb:function(t,e){},UKb1:function(t,e){},bTWF:function(t,e){},e2F2:function(t,e){},hLJu:function(t,e){},hZhd:function(t,e){},kK4M:function(t,e){},l600:function(t,e){},pguA:function(t,e){},qCYc:function(t,e){},qDiX:function(t,e){},xkSc:function(t,e){},zpZT:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.ab3d2c6049b46c9823d2.js.map